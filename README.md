# Как обойти блокировку youtube с помощью роутера. Гайд для самых маленьких.

Обойти DPI(блокировки) можно несколькими способами:
1. Купить впн и настроить под него роутер. Инструкции, как это делается, обычно прилагают провайдеры vpn. Но у этого способа есть несколько минусов: 1. Дорого(~~не бесплатно~~) 2. Ркн постоянно банят впн сервисы, смена протоколов зачастую не помогает.
2. Арендовать собственный vps. Это выйдет еще дороже, чем впн(~15$/месяц). Но заблокировать все провайдеры vps просто невозможно, и при правильной настройке DPI будет пропускать ваш трафик без проблем. Вот [гайд](https://habr.com/en/articles/791724/) и [еще один](https://habr.com/en/articles/548110/), как это можно сделать. 
3. Использовать [zapret](https://github.com/bol-van/zapret) и роутер с кастомной прошивкой  [openwrt](https://openwrt.org/). Данный метод не поможет обойти блокировки по ip, но гораздо расширит доступные для посещения сайты. Именно этот метод будет описывать данный гайд. 
4. Ну и не могу не упомянуть про [GoodbyeDPI](https://github.com/ValdikSS/GoodbyeDPI), правда его его не поставить на роутрер. 

Что нам собственно понадобиться?
1. Роутер, который поддерживает openwrt. Проверить это можно на [сайте](https://firmware-selector.openwrt.org/), просто вбив его название в строку поиска.
2. Прямые руки и минимальная способность работы с компьютером и гуглом. 

Важно, чтобы роутер имел достаточно flash(постоянная) и ram(оперативка) памяти. 4/32 минимум, но лучше 8/64. 
## Перейдем к установке. Здесь нас может ждать 2 варианта:
1. Вам повезет, и прошивку можно будет поставить через родной веб интерфейс роутера. 
2. Придется поднимать TFTP(для передачи данных) сервер, подключать роутер по кабелю и делать все ручками. 
Проверить это можно с помощью официальной инструкции от openwrt, сделав запрос в брузер
"\[название вашего роутера] openwrt". Там есть перевод на русский, но зачастую он не полный, поэтому пользуемся eng (переключение яхыка на значке флажка) . **Советую детально изучить официальную инструкцию, потому что действия в зависимости от модели могут отличаться!** 

Если вы везунчик, качаете FACTORY IMAGE [отсюда](https://firmware-selector.openwrt.org/) и шьете через web интерфейс. 
Если нет, то выполняете следующие действия:
## Для Linux. 
Устанавливаем tftp сервер <br/>
$ sudo apt update // или какой у вас там менеджер пакетов(apt, yum, pacman...) <br/>
$ sudo apt-get install tftpd-hpa <br/>
$ sudo systemctl start tftpd-hpa // запускаем сервис <br/>
$ sudo mkdir -p /var/lib/tftpboot // создаем директорию для файлов, которые будут передаваться <br/>
$ sudo chown -R nobody:nogroup /var/lib/tftpboot // меняем права доступа <br/>
$ sudo chmod -R 777 /var/lib/tftpboot <br/>
$ sudo systemctl restart tftpd-hpa // перезапускаем <br/>

Теперь мы можем оционально проверить работоспособность нашего tftp. Скачиваем tftp на другой компьютер в нашей локальной сети(одна wifi точка) и пишем: <br/>
$ tftp 192.168.x.xxx // Это адрес пк, на котором стоит сервер <br/>
Если все работает, то ответ будет примерно такой: <br/>
$ tftp> <br/>
Мы можем попробовать загрузить файл с сервера, предварительно поместив его в /var/lib/tftpboot/имяфайла.txt <br/>
$tftp> get имяфайла.txt // должен быть ответ ok, загруженный файл появится в рабочей директории. <br/>
Сервер работатет, можно начинать шить роутер!

Дальше, скорее всего, нужно будет загрузить TFTP-RECOVERY image  [отсюда](https://firmware-selector.openwrt.org/), поместить его в папку /var/lib/tftpboot/ , подключить роутер по кабелю в порт lan, сбросить настройки(кнопка reset при включении), и роутер сам подгрузит прошивку. Возможно, понадобиться изменение локального адреса пк на статический(через NetworkManager, в настройках). <br/>
В любом случае, для каждого устройства своя последовательность действий. Узнать ее можно по гайду от openwrt! Как его найти, писалось выше. 
## Для windows. 
Качаем tftp сервер [отсюда](https://bitbucket.org/phjounin/tftpd64/downloads/Tftpd64-4.64-setup.exe). Собственно запускаем. <br/>
Изменяем Current Directory на ту, где у нас хранится прошивка, (которую нужно скачать [отсюда](https://firmware-selector.openwrt.org/), под названием TFTP-RECOVERY image). Дальше, скорее всего, подключаем роутер по кабелю в lan порт, сбрасываем настройки(кнопка reset при включении), и роутер сам подгрузит прошивку. Возможно, понадобиться изменение локального адреса пк на статический(через NetworkManager, в настройках). 
В любом случае, для каждого устройства своя последовательность действий. Узнать ее можно по гайду от openwrt! Как его найти, писалось выше. 
## Для macos
У современных маков нет ethernet порта) Поэтому сам я не пробовал, но действия примерно как у linux. То есть, нужно ручками поднять tftp и немного пошаманить с локальным адресом. Поэтому гугл и ютуб в помощь.

---

Какие основные проблемы могут случиться?
- Фаервол может блочить подключения. 
- tftp сервер может быть просто не запущен.
- Неправильно выстроенные настройки локальной сети(для каждого роутера индивидуально).
- Имя файла прошивки не совпадает с нужным(как в гайде от openwrt). 
Больше инфы про tftp метод и возможные ошибки от [openwrt](https://openwrt.org/docs/guide-user/troubleshooting/tftpserver). 

А еще можно попробовать поискать гайд на ютубе именно под ваш роутер. Гугл наше все!

---

Теперь роутер можно подключать к wan кабелю и wifi должен работать(возможно понадобиться нажать на кнопку wps). Подключаемся к новой созданной точке openwrt, вводим пароль, что на задней крышке роутера(либо можно подключится через wps). Вбиваем в браузере 192.168.1.1, переходим в панельку openwrt, там ставим пароль на админа и наши новые wifi точки. 

Нам осталось скачать [zapret](https://github.com/bol-van/zapret)(зеленая кнопка код -> скачать zip). Переименовываем папку просто в zapret(если он называется по другому). 
Перекидываем всю папку с ним на роутер с помощью команды scp. 
### Для linux / mac
$ scp -r -O zapret root@192.168.1.1:/tmp // zapret должен находится в текущей директории, либо пишите путь к нему <br/>
### Для windows
Качаем putty MSI windows installer [отсюда](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html). Вводим команду в cmd <br/>
$ pscp -r zapret root@192.168.1.1:/tmp // zapret должен находится в текущей директории, либо пишите путь к нему

Забиваем собственно root пароль(который мы ставили в панельке openwrt!). Дальше нам нужно подключится к роутеру по ssh и запустить скрипт-установщик. 
### Для linux/macos
$ ssh root@192.168.1.1 <br/>
$  ./tmp/zapret/install_easy.sh <br/>
### Для windows
Открываем putty, в host name вбиваем 192.168.1.1 , в порт - 22 . Нажимаем open, yes, login as: вбиваем root, password: тот, который мы установили для админки в openwrt. Дальше пишем: <br/>
$ ./tmp/zapret/install_easy.sh

Еще желательно изменить настроки dns, чтобы нам точно ничего не мешало пользоваться свободныи интернетом. Заходим в админку роутера (192.168.1.1 в браузере), дальше network -> interfaces -> wan -> edit -> advansed settings -> Use DNS servers advertised by peer убираем галочку -> в Use custom DNS servers добавляем 1.1.1.1 и 8.8.8.8 (это dns от cloudflare и google соответственно). 

Готово! Теперь мы можем ~~поводить кгб по губам~~ пользоваться youtube и некоторыми другими сервисами, забанеными в рф. 

В случае, если что то сломается, всегда можно удалить zapret, подключившись по ssh(уже умеем это делать!) и введя команду <br/>
$ ./opt/zapret/uninstall_easy.sh <br/>

Так же, если боитесь окирпичивания, можно купить роутер на авито(~500р) и перепрошить его.

Замечания, дополнения приветствуются!

Желаю удачи в обходе блокировок!
